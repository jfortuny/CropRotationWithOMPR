---
title: "Crop Rotation Documentation"
author: "Jos√© Fortuny"
date: "3/12/2021"
output:
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Synopsis

The Crop Rotation model attempts to allocate crops to fields such that the consumption needs of the
user are satisfied while adhering to a set of constraints, described below.


## Elements of the model

There are some basic components of the model that are required for the model to exist. These are:

* A **Farm**, which is a collection of Fields
* **Fields** in the farm. A field is defined, in this model,
as the unit of land that will be planted, as a whole, with a single
crop. Thus it is the minimal, indivisible, planting unit.
The fields can be used in the determination of the rotation or can be set aside. 
The fields have a _measure_, which is under user control and there is an amount of that _measure_ in 
each field. In a vegetable crop setting, the measure will likely be _length_ of row (feet or meters of beds or rows, 
depending on setup); in a farm crop setting, the measure will likely be _surface_ of each field (acres or hectares in each field).
* **Demand** is defined as the amount of each product that the user wants to produce in one year.
* The most complex component of the model are the **Crops** which are to be planted in **Fields** to meet the **Demand** for products. In the rotation model one of the more important characteristics of **Crops** is the month(s) in which they can be planted in the **Field** for the specific plant zone in which the **Farm** is located as well as the duration the **Crops** occupy the **Field** before releasing it potentially for the next **Crops**.


## Importing Farm Data

The model accepts its data from an Excel spreadsheet with tab names that identify the elements of the model 
and tab columns that identify the attributes of the element. Both tab names and column structure must adhere
to the standard format that follows. Three tabs are required in the model:

* Farmland
* Demand
* Crops

The spreadsheet must have at least three tabs named with the labels listed; without them the data import will fail.

### Farmland

The **Farmland** tab identifies the **Fields** in the **Farm** by name, their _Measure_ and how much land is _Available_, and whether or not they should be _Included_ in the rotation (acceptable values are Y or N).
The contents of the **Farmland** tab looks like this:


```{r fig.align = 'center', echo=FALSE}
library(knitr)
knitr::include_graphics('images/Farmland Tab.png')
```

### Demand

The **Demand** tab identifies the Crop using a measure called **Is Same Crop As** (described under the Crop tab)
and the amount of the crop required for a year or **Yearly Demand**. The unit of measure of the **Yearly Demand**
is determined by the user and it requires consistency with the measure of yield in the Crop and by reference to the
**Field** unit of measure; i.e., if the crop yields are expressed in pounds per foot of row then the demand should be expressed in pounds per year and the fields should be measured in row feet. 
The contents of the **Demand** Tab looks like follows:

```{r fig.align = 'center', echo=FALSE}
library(knitr)
knitr::include_graphics('images/Demand Tab.png')
```


### Crops

The **Crops** tab identifies the crops the user considers planting and a large collection of attributes about those crops. It also indicates whether a crop is to be planted or not in column **Plant?**. 
The contents of the **Crops** tab that follows shows the columns of the spreadsheet in three images for clarity.

```{r fig.align = 'center', echo=FALSE}
library(knitr)
knitr::include_graphics('images/Crops Tab Left.png')
```

The tab above collects the name of the **Crop**, its botanical **Family**, whether the crop **Is Annual or Perennial?**, although the model currently excludes perennial crops from the rotation and whether the crop contributes to meet the user demand as other crops, column **Is Same Crop As**. In the image you can see how both bush beans and pole beans produce the same product: bean.


```{r fig.align = 'center', echo=FALSE}
library(knitr)
knitr::include_graphics('images/Crops Tab Middle.png')
```

The tab above repeats the  **Crop**, as well as adding some attributes of the crop itself (**Is Heavy Feeder?, Is Weed Contributor?, Is Cover Crop?**, which the model will attempt to plant to keep the soil from laying bare) and constraints that the user wants to impose on the crop (**Years between plantings on the same field**). Finally, column J identifies **Yield per Unit of Field**, which represents the amount of product that the field will produce of the crop in the same units of measure as in the **Demand** tab and the **Farmland** tab.


```{r fig.align = 'center', echo=FALSE}
library(knitr)
knitr::include_graphics('images/Crops Tab Right.png')
```

The tab above repeats the  **Crop**, as well as adding attributes related to the planting season of the crop in your plant zone (columns K through V), in this example Zone 7.The **Days to Maturity** identifies how long the specific crop the user has selected will stay in the ground before harvest, thus releasing the field for the next crop. The last column, **Plant?** identifies whether the crop is to be included in the rotation or excluded from it.

\newpage

# The Model

The model we use to generate a crop rotation is a mixed integer linear programming model of the general form:

$$
\begin{aligned}
\text  {Min} &\sum c X + d Y \\ 
\text {s.t.} &\sum A X + \sum B Y = 0 \\ 
             &X \ge 0\\ 
             &Y \in \{0,1\}
\end{aligned}
$$
